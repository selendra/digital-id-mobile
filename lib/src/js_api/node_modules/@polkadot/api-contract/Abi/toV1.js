// Copyright 2017-2022 @polkadot/api-contract authors & contributors
// SPDX-License-Identifier: Apache-2.0
import { convertSiV0toV1 } from '@polkadot/types';
import { objectSpread } from '@polkadot/util';

function v0ToV1Names(all) {
  return all.map(e => objectSpread({}, e, {
    name: Array.isArray(e.name) ? e.name : [e.name]
  }));
}

export function v0ToV1(registry, v0) {
  return registry.createType('ContractMetadataV1', objectSpread({}, v0, {
    spec: objectSpread({}, v0.spec, {
      constructors: v0ToV1Names(v0.spec.constructors),
      messages: v0ToV1Names(v0.spec.messages)
    }),
    types: convertSiV0toV1(registry, v0.types)
  }));
}